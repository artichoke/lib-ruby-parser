#[cfg(feature = "lib-ruby-parser-nodes")]
pub(crate) mod helpers;

#[cfg(feature = "lib-ruby-parser-nodes")]
mod bindings_messages_c;
#[cfg(feature = "lib-ruby-parser-nodes")]
mod messages_c;
#[cfg(feature = "lib-ruby-parser-nodes")]
mod messages_h;

#[cfg(feature = "lib-ruby-parser-nodes")]
mod bindings_nodes_c;
#[cfg(feature = "lib-ruby-parser-nodes")]
mod nodes_c;
#[cfg(feature = "lib-ruby-parser-nodes")]
mod nodes_h;

#[cfg(feature = "lib-ruby-parser-nodes")]
mod bindings_h;

#[cfg(feature = "lib-ruby-parser-nodes")]
mod blobs_gen_c;
#[cfg(feature = "lib-ruby-parser-nodes")]
mod blobs_gen_h;

#[cfg(feature = "lib-ruby-parser-nodes")]
pub(crate) fn codegen() {
    let options = codegen_options();

    bindings_messages_c::codegen(&options);

    messages_h::codegen();
    messages_c::codegen();

    bindings_nodes_c::codegen(&options);

    nodes_h::codegen();
    nodes_c::codegen();

    bindings_h::codegen(&options);

    blobs_gen_h::codegen();
    blobs_gen_c::codegen();
}

#[cfg(feature = "lib-ruby-parser-nodes")]
pub(crate) fn codegen_options() -> lib_ruby_parser_bindings::Options {
    let pre_code = format!(
        "// This file is autogenerated by {generator}
#include \"structs.h\"
#include \"blobs.h\"",
        generator = file!()
    );

    lib_ruby_parser_bindings::Options {
        pre_code,
        ..Default::default()
    }
}

#[cfg(not(feature = "lib-ruby-parser-nodes"))]
pub(crate) fn codegen() {
    println!("Skipping codegen in {}", file!())
}
